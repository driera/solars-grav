{% for p in pages.children.visible %}
    {% set current_page = (p.active or p.activeChild) ? 'is-active' : '' %}
    
    {% if p.children.visible.count > 0 %}
        <div class="main-nav--item main-nav--dropdown is-open">
            <a 
            href="{{ p.url }}" 
            class="main-nav--link {{ p.slug }} {{ current_page }}" 
            {% if p.template == 'external' %} target="_BLANK" rel="noopener" {% endif %}>
                {{ p.menu }}
            </a>

            <div class="main-nav--dropdown-list">
                {% for children in p.children %}
                    {% set current_child = children.active ? 'is-children-active' : '' %}
                    <a 
                    href="{{ children.url }}" 
                    class="main-nav--dropdown-item {{ 'is-' ~ children.slug }} {{ current_child }}" 
                    {% if children.template == 'external' %} target="_BLANK" rel="noopener" {% endif %}>
                        {{ children.menu }}
                    </a>
                {% endfor %}
            </div>
        </div>
    {% else %}
        <a 
        href="{{ p.url }}" 
        class="main-nav--item main-nav--link {{ p.slug }} {{ current_page }}" 
        {% if p.template == 'external' %} target="_BLANK" rel="noopener" {% endif %}>
            {{ p.menu }}
        </a>
    {% endif %}
{% endfor %}
